# ESP32 BPM Detector - API Reference

*Generated by MCP-Prompts `/esp32-bpm-api-endpoint`*

## Overview

The ESP32 BPM Detector provides a RESTful API for accessing BPM detection data, system status, and configuration. All endpoints support JSON responses with optional FlatBuffers binary format.

## Base URL

```
http://esp32-bpm.local
# or
http://<ESP32_IP_ADDRESS>
```

## Authentication

Currently, the API does not require authentication. Future versions will support API key authentication.

## Endpoints

### BPM Data Endpoints

#### GET `/api/v1/bpm/current`

Get the current BPM detection result.

**Response Format**: JSON

**Response Example**:
```json
{
  "bpm": 120.5,
  "confidence": 0.85,
  "signal_level": 0.72,
  "status": "detecting",
  "timestamp": 1234567890
}
```

**Response Fields**:
- `bpm` (float): Detected beats per minute
- `confidence` (float): Detection confidence (0.0-1.0)
- `signal_level` (float): Audio signal level (0.0-1.0)
- `status` (string): Detection status (`initializing`, `detecting`, `low_signal`, `no_signal`, `error`, `calibrating`)
- `timestamp` (uint64): Unix timestamp in milliseconds

**Status Codes**:
- `200 OK`: Success
- `500 Internal Server Error`: BPM detector not initialized

---

#### GET `/api/v1/bpm/spectrum`

Get audio spectrum analysis data (future implementation).

**Response Format**: JSON

**Status**: Not yet implemented

---

### System Endpoints

#### GET `/api/v1/system/status`

Get system status and health metrics.

**Response Format**: JSON

**Response Example**:
```json
{
  "uptime_seconds": 3600,
  "free_heap_bytes": 245760,
  "cpu_usage_percent": 25,
  "wifi_rssi": -50
}
```

**Response Fields**:
- `uptime_seconds` (uint64): System uptime in seconds
- `free_heap_bytes` (uint32): Available heap memory in bytes
- `cpu_usage_percent` (uint8): CPU usage percentage (0-100)
- `wifi_rssi` (int8): WiFi signal strength in dBm

**Status Codes**:
- `200 OK`: Success

---

#### GET `/api/v1/system/config`

Get current system configuration.

**Response Format**: JSON

**Response Example**:
```json
{
  "sample_rate": 25000,
  "fft_size": 1024,
  "min_bpm": 60,
  "max_bpm": 200,
  "detection_threshold": 0.5,
  "confidence_threshold": 0.3
}
```

**Response Fields**:
- `sample_rate` (uint32): Audio sample rate in Hz
- `fft_size` (uint16): FFT window size
- `min_bpm` (uint8): Minimum detectable BPM
- `max_bpm` (uint8): Maximum detectable BPM
- `detection_threshold` (float): Beat detection threshold (0.0-1.0)
- `confidence_threshold` (float): Minimum confidence to report BPM (0.0-1.0)

**Status Codes**:
- `200 OK`: Success

---

#### GET `/api/v1/system/health`

Health check endpoint for monitoring and load balancers.

**Response Format**: JSON

**Response Example**:
```json
{
  "status": "ok",
  "uptime": 3600000,
  "heap": 245760,
  "wifi_connected": true
}
```

**Response Fields**:
- `status` (string): System status (`ok`, `degraded`, `error`)
- `uptime` (uint64): System uptime in milliseconds
- `heap` (uint32): Free heap memory in bytes
- `wifi_connected` (boolean): WiFi connection status

**Status Codes**:
- `200 OK`: System healthy
- `503 Service Unavailable`: System degraded or error state

---

## WebSocket Endpoint (Future)

#### GET `/ws`

WebSocket endpoint for real-time BPM data streaming (not yet implemented).

**Status**: Planned for future release

---

## Error Responses

All endpoints may return error responses in the following format:

```json
{
  "error": "Error message description",
  "code": "ERROR_CODE",
  "timestamp": 1234567890
}
```

**Common Error Codes**:
- `INTERNAL_ERROR`: Internal server error
- `NOT_INITIALIZED`: Component not initialized
- `INVALID_REQUEST`: Invalid request parameters
- `SERVICE_UNAVAILABLE`: Service temporarily unavailable

---

## Rate Limiting

Currently, no rate limiting is implemented. Future versions will include:
- 100 requests per minute per IP
- Burst allowance of 20 requests

---

## Data Formats

### JSON Format (Current)

All endpoints currently return JSON data. This is the default and recommended format for most use cases.

### FlatBuffers Format (Planned)

Future versions will support FlatBuffers binary format for:
- Reduced payload size
- Faster parsing
- Zero-copy access

To request FlatBuffers format, include header:
```
Accept: application/octet-stream
```

---

## Usage Examples

### Python Example

```python
import requests

# Get current BPM
response = requests.get('http://esp32-bpm.local/api/v1/bpm/current')
bpm_data = response.json()
print(f"BPM: {bpm_data['bpm']}, Confidence: {bpm_data['confidence']}")

# Get system status
response = requests.get('http://esp32-bpm.local/api/v1/system/status')
status = response.json()
print(f"Uptime: {status['uptime_seconds']}s, Heap: {status['free_heap_bytes']} bytes")
```

### cURL Example

```bash
# Get current BPM
curl http://esp32-bpm.local/api/v1/bpm/current

# Get system health
curl http://esp32-bpm.local/api/v1/system/health

# Get configuration
curl http://esp32-bpm.local/api/v1/system/config
```

### JavaScript/Node.js Example

```javascript
const axios = require('axios');

// Get current BPM
async function getCurrentBPM() {
  try {
    const response = await axios.get('http://esp32-bpm.local/api/v1/bpm/current');
    console.log(`BPM: ${response.data.bpm}, Confidence: ${response.data.confidence}`);
    return response.data;
  } catch (error) {
    console.error('Error fetching BPM:', error);
  }
}

// Poll BPM every second
setInterval(getCurrentBPM, 1000);
```

---

## API Versioning

The API uses URL-based versioning:
- Current version: `v1`
- Future versions: `v2`, `v3`, etc.

Old API versions will be maintained for backward compatibility.

---

## Changelog

### v1.0.0 (2024-12-24)
- Initial API release
- BPM current endpoint
- System status and health endpoints
- Configuration endpoint

### Planned for v1.1.0
- WebSocket support for real-time streaming
- FlatBuffers binary format
- Authentication and rate limiting
- Spectrum analysis endpoint

---

*This API documentation was automatically generated using MCP-Prompts specialized ESP32 development expertise.*

