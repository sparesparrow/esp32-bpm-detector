[platformio]
default_envs = esp32s3

[env:esp32s3]
platform = espressif32@6.4.0
board = esp32-s3-devkitc-1
framework = arduino
monitor_speed = 115200
upload_speed = 57600
upload_protocol = esptool

# Build flags for ESP32
build_flags =
    -D CORE_DEBUG_LEVEL=2
    -D DEBUG_ESP_PORT=Serial
    -D PLATFORM_ESP32
    -std=c++17
    -O2
    -I.
    -Isrc
    -Iinclude
    -D CONFIG_IDF_TARGET_ESP32S3=1
    -Wno-cpp  # Suppress #warning directives from libraries

# Exclude Arduino platform files from ESP32 build
src_filter = +<*> -<platforms/arduino/>

# Libraries (ESP32-specific)
lib_deps =
    # FFT for beat detection (works on both platforms)
    kosme/arduinoFFT @ ^1.4.0

    # ESP32-only libraries
    ottowinter/ESPAsyncWebServer-esphome @ ^3.1.0
    me-no-dev/AsyncTCP @ ^1.1.1
    adafruit/Adafruit SSD1306 @ ^2.5.7
    TM1637Display @ ^1.1.0
    bblanchon/ArduinoJson @ ^6.21.2
    knolleary/PubSubClient @ ^2.8.0

    # FlatBuffers is included locally in lib/flatbuffers

# Optimization flags
[env:esp32dev-release]
platform = espressif32@6.4.0
board = esp32dev
framework = arduino
monitor_speed = 115200
upload_speed = 921600
build_flags =
    -D CORE_DEBUG_LEVEL=0
    -O3
    -std=c++17

# Test environment (for development/debugging)
[env:esp32dev-debug]
platform = espressif32@6.4.0
board = esp32dev
framework = arduino
monitor_speed = 115200
upload_speed = 921600
build_flags =
    -D CORE_DEBUG_LEVEL=5
    -D PLATFORM_ESP32
    -g
    -O0
    -std=c++17

# Arduino Uno environment
[env:arduino_uno]
platform = atmelavr
board = uno
framework = arduino
monitor_speed = 9600
upload_speed = 9600

# Build flags for Arduino
build_flags =
    -D PLATFORM_ARDUINO
    -std=c++11  # Arduino uses C++11
    -O2
    -I.
    -Isrc

# Arduino Nano environment
[env:arduino_nano]
platform = atmelavr
board = nanoatmega328
framework = arduino
monitor_speed = 9600
upload_speed = 9600

# Build flags for Arduino Nano
build_flags =
    -D PLATFORM_ARDUINO
    -std=c++11
    -O2
    -I.
    -Isrc
